# diary@20220506

## [字节高并发优惠券系统设计](https://blog.csdn.net/ByteDanceTech/article/details/124207051)
_tags: #architecture #concurrency #performance_

> - 实测数据库性能瓶颈：
>   - 单个 MySQL 的每秒写入在 4000 QPS 左右，超过这个数字，MySQL 的 I/O 时延会剧量增长。
>   - MySQL 单表记录到达了千万级别，查询效率会大大降低，如果过亿的话，数据查询会成为一个问题。
>   - Redis 单分片的写入瓶颈在 2w 左右，读瓶颈在 10w 左右
> - 容量预估 (120k QPS)：
>   - MySQL 主库资源为：120k / 4k = 30
>   - Redis 资源：120k / 20k =6
> - 效果：系统在 13w QPS 的发券请求下，请求成功率达到 99.9%以上，系统监控正常。春节红包雨期间，该优惠券系统承载了两次红包雨的全部流量，期间未出现异常。

### 思辨
- 字节果然财大气粗，直接怼 150% 硬件资源，完全不考虑弹性伸缩。
- 抢券业务应该没有强实时性需求吧，为什么不上消息队列对抢券请求做缓冲？
- 峰值 13w qps 在生产环境中占比不会太高，以 80% ／ 90% 分位线为首作容量预估更合适吧。
- 这是纯技术手段处理高并发问题了，性价比更高的方案是做业务分流，如错时发券、预约发券、先用先得等。
